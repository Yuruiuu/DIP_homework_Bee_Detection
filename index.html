<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Bee Detection </title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
    <script src="https://use.fontawesome.com/releases/v5.0.8/js/all.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@0.11.2"> </script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@2.8.0"></script>
    <link rel="stylesheet" href="E:\DIP_Bee_Detection\Bee_Detection-main\Bee_Detection-main\templates\static\style.css" type="text/css">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <style>
        body {
            background-color: #f8f9fa;
        }

        .container {
            margin-top: 50px;
        }

    </style>
</head>

<body>
    <!--- Cards -->
    <div class="container mt-5">
        <div class="container">
            <h1 class="text-center mb-4">Bee Facts</h1>


             <!-- 检测功能区（分为图片检测和视频检测两个卡片） -->
        <div class="row">
            <!-- 1. 图片检测卡片 -->
            <div class="col-lg-6 mb-5">
                <div class="detect-card">
                    <h3 class="text-center mb-4 text-success"><i class="fas fa-image mr-2"></i>Image Bee Detection</h3>
                    <!-- 图片上传表单 -->
                    <form action="{{ url_for('detect') }}" method="post" enctype="multipart/form-data" id="image-form">
                        <div class="form-group">
                            <label for="image-upload" class="font-weight-bold">Select Image File:</label>
                            <div class="input-group">
                                <input type="file" name="image_file" id="image-upload" accept="image/jpeg, image/png, image/jpg"
                                       class="form-control" required>
                                <div class="input-group-append">
                                    <button type="submit" class="btn btn-detect">
                                        <i class="fas fa-search mr-1"></i>Detect Bees
                                    </button>
                                </div>
                            </div>
                            <small class="form-text text-muted">Supported formats: JPG, JPEG, PNG (max size: 10MB)</small>
                        </div>

                        <!-- 图片预览区域 -->
                        <div class="image-preview-container">
                            <p id="image-preview-text">No image selected yet</p>
                            <!-- 上传的原始图片预览 -->
                            <img id="original-image" class="preview-img" alt="Original Image">
                            <!-- 检测后的结果图片预览（默认隐藏） -->
                            <img id="result-image" class="preview-img" alt="Detection Result Image" style="display: none; margin-top: 20px;">
                            <p id="detection-count" class="mt-3 text-success" style="display: none;"></p>
                        </div>
                    </form>
                </div>
            </div>

            <!-- 2. 视频检测卡片（保留原功能，优化样式） -->
            <div class="col-lg-6 mb-5">
                <div class="detect-card">
                    <h3 class="text-center mb-4 text-success"><i class="fas fa-video mr-2"></i>Video Bee Detection</h3>
                    <!-- 视频上传表单 -->
                    <form action="{{ url_for('detect') }}" method="post" enctype="multipart/form-data">
                        <div class="form-group">
                            <label for="video-upload" class="font-weight-bold">Select Video File:</label>
                            <div class="input-group">
                                <input type="file" name="file" id="video-upload" accept=".mp4, .mov, .avi"
                                       class="form-control" required>
                                <div class="input-group-append">
                                    <button type="submit" class="btn btn-detect">
                                        <i class="fas fa-search mr-1"></i>Detect Bees
                                    </button>
                                </div>
                            </div>
                            <small class="form-text text-muted">Supported formats: MP4, MOV, AVI (max size: 100MB)</small>
                        </div>

                        <!-- 视频信息提示（无预览，仅文字提示） -->
                        <div class="alert alert-info mt-3" role="alert">
                            <i class="fas fa-info-circle mr-2"></i>After uploading, the system will analyze key frames to detect bees.
                            Results (CSV + chart) will be available for download.
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- 检测结果展示区（图片+视频结果统一显示） -->
        {% if result %}
        <div class="results-section">
            <h3 class="text-center mb-4 text-dark"><i class="fas fa-clipboard-check mr-2"></i>Detection Results</h3>

            <!-- 图片检测结果 -->
            {% if result.type == 'image' %}
            <div class="row mb-4">
                <div class="col-lg-6 text-center">
                    <h5>Original Image</h5>
                    <img src="{{ result.original_image_url }}" alt="Original Image" class="img-fluid rounded shadow">
                </div>
                <div class="col-lg-6 text-center">
                    <h5>Detection Result ({{ result.bee_count }} Bees Detected)</h5>
                    <img src="{{ result.result_image_url }}" alt="Detection Result" class="img-fluid rounded shadow">
                    <p class="mt-3 text-success font-weight-bold">Detection Time: {{ result.detection_time }} seconds</p>
                    <a href="{{ result.result_image_download_url }}" class="btn btn-detect mt-2">
                        <i class="fas fa-download mr-1"></i>Download Result Image
                    </a>
                </div>
            </div>

            <!-- 视频检测结果（保留原功能） -->
            {% elif result.type == 'video' %}
            <div class="row">
                <div class="col-12">
                    <h5>Video Information</h5>
                    <ul class="list-group mb-3">
                        <li class="list-group-item"><b>File Name:</b> {{ result.output.filename }}</li>
                        <li class="list-group-item"><b>Video Duration:</b> {{ result.output.video_duration }}</li>
                        <li class="list-group-item"><b>Detection Time:</b> {{ result.output.detection_duration }}</li>
                        <li class="list-group-item"><b>Total Processing Time:</b> {{ result.output.api_time }}</li>
                    </ul>

                    <h5>Result Downloads</h5>
                    <div class="btn-group" role="group">
                        <a href="{{ url_for('download_csv') }}" class="btn btn-detect">
                            <i class="fas fa-file-csv mr-1"></i>Download Detection CSV
                        </a>
                        <a href="{{ url_for('download_image') }}" class="btn btn-detect ml-2">
                            <i class="fas fa-file-image mr-1"></i>Download Detection Chart
                        </a>
                    </div>

                    <!-- 视频检测图表预览 -->
                    <div class="mt-4">
                        <h5>Detection Trend Chart</h5>
                        <img src="{{ url_for('static', filename='imgs/plot.jpeg') }}" alt="Detection Trend" class="img-fluid rounded shadow">
                    </div>
                </div>
            </div>
            {% endif %}
        </div>
        {% else %}
        <!-- 无结果时的提示 -->
        <div class="alert alert-secondary text-center" role="alert">
            <i class="fas fa-lightbulb mr-2"></i>Upload an image or video and click "Detect Bees" to see results
        </div>
        {% endif %}

            <form action="{{url_for('detect')}}" method="post" enctype="multipart/form-data">
                <div class="input-group">
                    <input type="file" name="file" accept=".mp4, .mov" class="form-control">
                    <div class="input-group-append">
                        <button type="submit" id="detect-button" class="btn btn-primary">Detect Bees</button>
                    </div>
                </div>
            </form>
        </div>
    </div>
    <!-- <h3 class="text-center">Bee Detection API</h1> -->
    <!-- Display values from the 'output' dictionary if 'success' is True -->
    {% if result.success %}
    <!--- Cards -->
    <div class="container mt-5">
        <!-- ... -->
        <div id="results-section" class="container">
            <h2>Results</h2>

            <p>{{ result.output.filename }}</p>
            <p>{{ result.output.detection_duration }}</p>
            <p>{{ result.output.api_time }}</p>
            <p>{{ result.output.video_duration }}</p>

            <!-- Create hyperlinks for downloading CSV and image files -->
            <p>Download CSV: <a href="{{ url_for('download_csv') }}" download>Click here</a></p>
            <!-- <h2>Image:</h2> -->
            <!-- <img src="{{url_for('static' ,filename='imgs/plot.jpeg')}}" alt="Image" class="img-fluid"> -->
            <p>Download Image: <a href="{{ url_for('download_image') }}" download>Click here</a></p>

        </div>
    </div>
    {% else %}
    <div class="container mt-5">

        <p><b> For Results: Try uploading a video and press the Detect Bee Button.</b></p>
        {% endif %}
    </div>

    </div>

    <!--- Meet the team -->
    <div class="container-fluid padding">
        <div class="row welcome text-center">
            <div class="col-12">
                <!-- <p class="lead">I completed my B.Tech in Computer Science </p> -->
                <p class="lead"> You can check my resume <a href="static\files\AJAY JOHN ALEX DA CV.pdf"
                        target="_blank"> here </a></p>
                <p class="lead"> Email me at : <a href="https://mail.google.com/mail/u/0/#inbox" target="_blank">
                        ajay.alex96@gmail.com.</a>
            </div>

        </div>
    </div>


    <!--- Footer -->
    <footer>
        <div class="container-fluid padding">
            <div class="row welcome text-center">
                <div class="col-12">
                    <hr class="light">
                    <!--- Connect -->
                    <div class="container-fluid padding">
                        <div class="row welcome text-center">
                            <div class="col-12">
                                <h2> Connect</h2>
                            </div>
                            <div class="col-12 social padding">
                                <a href="https://github.com/AjayJohnAlex" target="_blank">
                                    <i class="fab fa-github"></i>
                                </a>
                                <a href="https://www.linkedin.com/in/ajay-john-alex96/" target="_blank">
                                    <i class="fab fa-linkedin-in"></i>
                                </a>
                                <a href="https://datascienceportfolio.onrender.com" target="_blank">
                                    <i class="fa fa-code"></i>
                                </a>
                                <a href="https://www.instagram.com/ajay_john_alex/" target="_blank">
                                    <i class="fab fa-instagram"></i>
                                </a>
                            </div>
                        </div>
                    </div>
                    <hr class="my-4">
                </div>

                <div class="col-12">
                    <hr class="light100">
                    <h5>&copy; Ajay John Alex</h5>
                </div>
            </div>
        </div>
    </footer>
</body>

<!-- Include Bootstrap JS and jQuery -->
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js"></script>

</html>